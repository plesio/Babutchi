# 育児イベント記録装置 Babu Client 「ばぶっち」

![image_shot](https://user-images.githubusercontent.com/10129511/165226971-7c09bd3b-0daa-421b-8f53-ddb0ed3da17b.png)

スマホアプリに依存しない、React ベースの育児イベント記録装置。

## 簡単な仕組み

1. ばぶっちで展開したイベントボタンを押す。
2. ばぶっち上でイベントデータを生成して、指定した GAS の POST URL に投げる。
3. GAS で処理をして、スプレッドシートに記録される。

## 要求環境

- Http サーバー
  - PC を常駐しても良いし、家の中に Apache2 を立てても良い。
  - 私は、用途を終えた Android に nanohttpd を内包した自作 App を立ち上げて常駐している。
- Google Spreadsheet
  - イベントの記録用。
- GAS(Google Apps Script)
  - イベントデータを POST で受け付ける URL をこいつで制御する。

## 制限事項

- 記録系を Google に依存している。
  - この部分は、他サービスでもかまわない。
- POST URL へのアクセスについて、セキュリティを無視しているので、可能な限りローカルで運用するべき。
  - アクセスが容易ではない URL であれば、AWS EC2 の無料枠にデプロイするなどでも良いかもしれない。
- 実際に育児が始まって、使いながら不便なところを直そうと思ったら、育児は自分の時間が取れない。直せない。仕方ないから公開までして放置する。

## 最短運用方法

### release.zip の DL

リリースから最新を落として、各種 html,js と post_url.json が入っていることを確認する。

post_url.json は後述するが、中身を修正する必要がある。

### SpreadSheet の用意

Google Spreadsheet の記録したいシートを用意。

### GAS の用意

作った SpreadSheet から「拡張機能」→「GAS」で、GAS を関連付けた状態で開く。

新規の.gs を起こして、ソースに含まれている。

> ext_src/babu_postReport.js

の中身をコピーする。 ついでにその中の SHEET_NAME の定数を記録したいシート名に書き換える。

その gs ファイルをデプロイして、URL を生成する。 デプロイする際、実行ユーザーは自分自身にしないと、POST 要求時にログインを要求されてばぶっち上から気軽に使えない。

### 利用するためのファイル修正

> post_url.json

の "url" を GAS でデプロイした URL に書き換える。

### どこかにデプロイする

単純にVS CODEとかを使って簡単なHTTPサーバーを建てる程度でいいと思っている。

前述の通り、セキュリティ無視した設計になっているので、配置したjson直接盗られると、変なPostがスプレッドシートに記録されうる。

ちなみに、一度ブラウザに展開してリロードされない限りは、外出先でもボタンは動く。

# ビルド方法

- npm i
- npm run export

export で HTML が out ディレクトリに格納されるので、それをつかってよしなに。

- npm run serve

や

- npm run dev

で動作を見ることが可能。ここらへんは nextjs の挙動のまま。

# MEMO: vite(build SPA) -> nextjs(build Static HTML export)

ビルド結果を表示するときに使用する転送量

- vite : 要求 7 件 / 548.85 KB / 549.90 KB 転送済み
- nextjs : 要求 12 件 / 530.13 KB / 150.14 KB 転送済み

となって、総サイズ量が減ったので乗り換えてみた。（どのみち nanoHttpd 使うとキャッシュの概念がないから、常に全ファイル取ってくる挙動になるけど）
